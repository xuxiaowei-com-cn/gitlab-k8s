stages:
  - build
  # 代码同步
  - sync

build:npm:
  stage: build
  script:
    # Git 下载地址：https://github.com/git-for-windows/git/releases
    # 中文文档：https://docs.gitlab.cn/runner/install/windows.html
    # 最新版下载地址：
    # https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-windows-amd64.exe
    # https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-windows-386.exe
    # PowerShell 下载地址：https://github.com/PowerShell/PowerShell/releases
    - cd $CI_PROJECT_DIR
    - npm config set registry https://registry.npmmirror.com
    - echo $CI_PIPELINE_SOURCE
    - if [ $CI_PIPELINE_SOURCE == web ]; then
      npm install;
      fi
    - npm run build
    - mv build/ public/
  artifacts:
    expire_in: 1 week
    paths:
      - public/
  tags:
    - windows
  rules:
    - if: $CI_COMMIT_BRANCH == "build/windows"

# 嵌入
include:
  # 同步代码
  - /sync.yml
